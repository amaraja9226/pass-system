{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Renew Pass Receipt</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #f4f6f9;
            font-family: "Poppins", sans-serif;
        }

        .receipt-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 850px;
            margin: 30px auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: none;
            position: relative;
        }

        /* PAID STAMP */
        .paid-stamp {
            position: absolute;
            top: 45%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-25deg);
            font-size: 80px;
            font-weight: 900;
            color: red;
            opacity: 0.18;
            border: 6px solid red;
            padding: 15px 40px;
            border-radius: 12px;
            display: none;
            z-index: 999;
        }

        .section-title {
            font-weight: 600;
            margin: 15px 0 5px;
            border-left: 4px solid #0d6efd;
            padding-left: 10px;
        }
    </style>
</head>

<body>

<!-- Wrapper -->
<div id="receiptArea">

    <div class="receipt-card">

        <!-- PAID STAMP -->
        <div id="paidStamp" class="paid-stamp">PAID</div>

        <!-- Header -->
        <div class="header d-flex justify-content-between align-items-center mb-4">
            <div>
                <img src="{% static 'images/siit.png' %}" alt="College Logo" width="120">
            </div>

            <div class="text-center">
                <h3>SHRIRAM SHIKSHAN SANSTA PANIV</h3>
                <p><strong>Renew Pass Receipt</strong></p>
            </div>

            <div class="text-end">
                <p><strong>Date:</strong> {{ current_date }}</p>
                <p><strong>Month:</strong> {{ current_month }}</p>
            </div>
        </div>

        <!-- Student Information -->
        <h5 class="section-title">Student Information</h5>

        <div class="details mb-4">
            <div class="row">

                <div class="col-md-6">
                    <p><strong>Name:</strong> {{ renew_pass.name }}</p>
                    <p><strong>Class:</strong> {{ renew_pass.student_class }}</p>
                    <p><strong>Department:</strong> {{ renew_pass.department }}</p>
                    <p><strong>Village:</strong> {{ renew_pass.village }}</p>
                    <p><strong>Date:</strong> {{ renew_pass.created_at|date:"d-m-Y" }}</p>
                    <p><strong>Month:</strong> {{ renew_pass.month }}</p>
                    <p><strong>Amount:</strong> ₹{{ renew_pass.amount }}</p>
                </div>

                <div class="col-md-6 text-center">
                    {% if original_pass %}
                        <label class="form-label fw-bold">Student Photo</label><br>
                        <img src="{{ renew_pass.photo.url }}" class="img-thumbnail" alt="Photo" style="max-height:150px;">
                    {% endif %}
                </div>

            </div>
        </div>

        <!-- Signatures -->
        <h5 class="section-title">Signatures</h5>
        <div class="signatures d-flex justify-content-between mt-3">

            <div class="text-center">
                <p class="fw-bold">Admin</p>
                <img src="{% static 'signatures/admin.png' %}" alt="Admin Sign" style="max-height:70px;">
            </div>

            <div class="text-center">
                {% if original_pass.student_signature %}
                    <p class="fw-bold">Student</p>
                    <img src="{{ original_pass.student_signature.url }}" alt="Signature" style="max-height:70px;">
                {% endif %}
            </div>

            <div class="text-center">
                <p class="fw-bold">Sub-admin</p>
                <img src="{% static 'signatures/subadmin.png' %}" alt="Sub-admin Sign" style="max-height:70px;">
            </div>

        </div>

    </div>
</div>

<!-- Pay Button -->
<div class="text-center mt-4 mb-5">
    <a href="{% url 'pay_and_download_pdf' renew_pass.id %}" class="btn btn-primary btn-lg px-5 shadow">
        Pay Now
    </a>
</div>
<button onclick="payNow('{{ renew_pass.id }}')" class="btn btn-success btn-lg px-4">Pay Now</button>



<!-- html2pdf -->
<!-- html2pdf Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js">

function payNow(renewPassId) {
    fetch(`/renew/update-payment/${renewPassId}/`)
    .then(res => res.json())
    .then(data => {
        if(data.status === "success"){
            alert("Payment successful!");
            window.location.reload(); // refresh → PAID stamp show hoga
        } else {
            alert("Error: " + data.message);
        }
    });
}
</script>

</script>
</body>
</html>